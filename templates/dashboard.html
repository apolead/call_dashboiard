{% extends "base.html" %}

{% block title %}ApoLead Call Analytics Dashboard{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h2 mb-2 text-gradient">
                        <i class="bi bi-graph-up me-2"></i>
                        Call Analytics Dashboard
                    </h1>
                    <p class="text-muted mb-0">
                        Real-time insights and transcription analytics for ApoLead
                    </p>
                </div>
                <div class="d-flex gap-2">
                    <!-- Date Range Picker -->
                    <div class="input-group" style="width: auto;">
                        <input type="date" class="form-control" id="startDate" title="Start Date">
                        <span class="input-group-text">to</span>
                        <input type="date" class="form-control" id="endDate" title="End Date">
                        <button class="btn btn-outline-primary" id="applyDateFilter">
                            <i class="bi bi-filter"></i>
                        </button>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="btn-group">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
                            <i class="bi bi-cloud-upload-fill me-1"></i>Upload
                        </button>
                        <button class="btn btn-success" id="s3SyncBtn">
                            <i class="bi bi-cloud-download-fill me-1"></i>Sync S3
                        </button>
                        <button class="btn btn-info" data-bs-toggle="modal" data-bs-target="#s3Modal">
                            <i class="bi bi-cloud-fill me-1"></i>Browse S3
                        </button>
                    </div>
                    
                    <!-- Auto-refresh Toggle -->
                    <div class="btn-group">
                        <button class="btn btn-outline-secondary" id="refreshBtn">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                        <button class="btn btn-outline-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
                            <span class="visually-hidden">Toggle Dropdown</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item active" href="#" data-interval="0">Manual only</a></li>
                            <li><a class="dropdown-item" href="#" data-interval="10">Every 10s</a></li>
                            <li><a class="dropdown-item" href="#" data-interval="30">Every 30s</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics Cards -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="metric-card metric-card-primary">
                <div class="metric-icon">
                    <i class="bi bi-telephone-fill"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="totalCalls">0</div>
                    <div class="metric-label">Total Calls</div>
                    <div class="metric-change" id="totalCallsChange">+0 today</div>
                </div>
                <div class="metric-progress">
                    <div class="progress">
                        <div class="progress-bar" id="totalCallsProgress"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="metric-card metric-card-success">
                <div class="metric-icon">
                    <i class="bi bi-check-circle-fill"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="successRate">0%</div>
                    <div class="metric-label">Success Rate</div>
                    <div class="metric-change" id="successRateChange">Processing quality</div>
                </div>
                <div class="metric-progress">
                    <div class="progress">
                        <div class="progress-bar bg-success" id="successRateProgress"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="metric-card metric-card-info">
                <div class="metric-icon">
                    <i class="bi bi-clock-fill"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="avgProcessingTime">0s</div>
                    <div class="metric-label">Avg Processing</div>
                    <div class="metric-change" id="processingTimeChange">Response time</div>
                </div>
                <div class="metric-progress">
                    <div class="progress">
                        <div class="progress-bar bg-info" id="processingTimeProgress"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="metric-card metric-card-warning">
                <div class="metric-icon">
                    <i class="bi bi-hourglass-split"></i>
                </div>
                <div class="metric-content">
                    <div class="metric-value" id="totalDuration">0h</div>
                    <div class="metric-label">Total Duration</div>
                    <div class="metric-change" id="durationChange">Audio processed</div>
                </div>
                <div class="metric-progress">
                    <div class="progress">
                        <div class="progress-bar bg-warning" id="durationProgress"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Section Toggle -->
    <div class="row mb-3">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h4 class="mb-0">
                    <i class="bi bi-graph-up me-2"></i>
                    Analytics & Charts
                </h4>
                <button class="btn btn-outline-primary btn-sm" type="button" data-bs-toggle="collapse" data-bs-target="#analyticsSection" aria-expanded="true" aria-controls="analyticsSection" id="analyticsToggle">
                    <i class="bi bi-chevron-up me-1" id="analyticsToggleIcon"></i>
                    <span id="analyticsToggleText">Collapse</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Collapsible Analytics Section -->
    <div class="collapse" id="analyticsSection">
    
    <!-- Charts Row -->
    <div class="row mb-4">
        <!-- Intent Distribution Chart -->
        <div class="col-lg-6 mb-4">
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">
                        <i class="bi bi-pie-chart-fill me-2"></i>
                        Intent Distribution
                    </h5>
                    <div class="analytics-card-actions">
                        <button class="btn btn-sm btn-outline-secondary" id="intentChartRefresh">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="analytics-card-body">
                    <canvas id="intentChart" width="400" height="300"></canvas>
                    <div id="intentChartLoading" class="chart-loading">
                        <div class="spinner-border text-primary" role="status"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Daily Trends Chart -->
        <div class="col-lg-6 mb-4">
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">
                        <i class="bi bi-graph-up me-2"></i>
                        Daily Call Trends
                    </h5>
                    <div class="analytics-card-actions">
                        <select class="form-select form-select-sm" id="trendsTimeRange" style="width: auto;">
                            <option value="7">Last 7 days</option>
                            <option value="14">Last 14 days</option>
                            <option value="30" selected>Last 30 days</option>
                        </select>
                    </div>
                </div>
                <div class="analytics-card-body">
                    <canvas id="trendsChart" width="400" height="300"></canvas>
                    <div id="trendsChartLoading" class="chart-loading">
                        <div class="spinner-border text-primary" role="status"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sub-Intent Charts Row -->
    <div class="row mb-4">
        <!-- Sub-Intent Distribution Chart -->
        <div class="col-lg-6 mb-4">
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">
                        <i class="bi bi-diagram-3-fill me-2"></i>
                        Sub-Intent Distribution
                    </h5>
                    <div class="analytics-card-actions">
                        <button class="btn btn-sm btn-outline-secondary" id="subIntentChartRefresh">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="analytics-card-body">
                    <canvas id="subIntentChart" width="400" height="300"></canvas>
                    <div id="subIntentChartLoading" class="chart-loading">
                        <div class="spinner-border text-primary" role="status"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Call Duration Distribution Chart -->
        <div class="col-lg-6 mb-4">
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">
                        <i class="bi bi-clock-history me-2"></i>
                        Call Duration Distribution
                    </h5>
                    <div class="analytics-card-actions">
                        <button class="btn btn-sm btn-outline-secondary" id="durationChartRefresh">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="analytics-card-body">
                    <canvas id="durationDistributionChart" width="400" height="300"></canvas>
                    <div id="durationDistributionChartLoading" class="chart-loading">
                        <div class="spinner-border text-primary" role="status"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Intent Sub-Intent Breakdown Row -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">
                        <i class="bi bi-diagram-2-fill me-2"></i>
                        Intent Sub-Category Breakdown
                    </h5>
                    <div class="analytics-card-actions">
                        <button class="btn btn-sm btn-outline-secondary" id="intentSubIntentBreakdownRefresh">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="analytics-card-body">
                    <div id="intentSubIntentBreakdownContainer" class="row">
                        <div id="intentSubIntentBreakdownLoading" class="chart-loading col-12">
                            <div class="spinner-border text-primary" role="status"></div>
                            <p class="mt-2">Loading intent breakdown...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Speaker Analytics Row -->
    <div class="row mb-4">
        <!-- Speaker Count Distribution Chart -->
        <div class="col-lg-6 mb-4">
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">
                        <i class="bi bi-people-fill me-2"></i>
                        Speaker Count Distribution
                    </h5>
                    <div class="analytics-card-actions">
                        <button class="btn btn-sm btn-outline-secondary" id="speakerChartRefresh">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="analytics-card-body">
                    <canvas id="speakerCountChart" width="400" height="300"></canvas>
                    <div id="speakerCountChartLoading" class="chart-loading">
                        <div class="spinner-border text-primary" role="status"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Drop-off Analysis -->
        <div class="col-lg-6 mb-4">
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">
                        <i class="bi bi-telephone-x me-2"></i>
                        Call Drop-off Analysis
                    </h5>
                    <div class="analytics-card-actions">
                        <button class="btn btn-sm btn-outline-secondary" id="dropoffChartRefresh">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="analytics-card-body">
                    <div id="dropoffAnalysisContainer">
                        <div id="dropoffAnalysisLoading" class="chart-loading">
                            <div class="spinner-border text-primary" role="status"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Disposition Analytics Row -->
    <div class="row mb-4">
        <!-- Primary Disposition Distribution Chart -->
        <div class="col-lg-6 mb-4">
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">
                        <i class="bi bi-pie-chart me-2"></i>
                        Primary Disposition Distribution
                    </h5>
                    <div class="analytics-card-actions">
                        <button class="btn btn-sm btn-outline-primary" id="classifyDispositionsBtn" title="Classify dispositions using AI">
                            <i class="bi bi-robot me-1"></i>Classify
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" id="primaryDispositionChartRefresh">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="analytics-card-body">
                    <canvas id="primaryDispositionChart" width="400" height="300"></canvas>
                    <div id="primaryDispositionChartLoading" class="chart-loading">
                        <div class="spinner-border text-primary" role="status"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secondary Disposition Distribution Chart -->
        <div class="col-lg-6 mb-4">
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">
                        <i class="bi bi-pie-chart-fill me-2"></i>
                        Secondary Disposition Distribution
                    </h5>
                    <div class="analytics-card-actions">
                        <span class="badge bg-info me-2" id="classificationRate">0% classified</span>
                        <button class="btn btn-sm btn-outline-secondary" id="secondaryDispositionChartRefresh">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                    </div>
                </div>
                <div class="analytics-card-body">
                    <canvas id="secondaryDispositionChart" width="400" height="300"></canvas>
                    <div id="secondaryDispositionChartLoading" class="chart-loading">
                        <div class="spinner-border text-primary" role="status"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div> <!-- End Collapsible Analytics Section -->

    <!-- Data Table Section -->
    <div class="row">
        <div class="col-12">
            <div class="analytics-card">
                <div class="analytics-card-header">
                    <h5 class="analytics-card-title">
                        <i class="bi bi-table me-2"></i>
                        Call Records
                        <span class="badge bg-secondary ms-2" id="recordCount">0</span>
                    </h5>
                    <div class="analytics-card-actions">
                        <!-- Search and Filters -->
                        <div class="d-flex gap-2">
                            <div class="input-group" style="width: 250px;">
                                <span class="input-group-text">
                                    <i class="bi bi-search"></i>
                                </span>
                                <input type="text" class="form-control form-control-sm" id="searchInput" placeholder="Search calls...">
                            </div>
                            
                            <select class="form-select form-select-sm" id="statusFilter" style="width: auto;">
                                <option value="">All Status</option>
                                <option value="completed">Completed</option>
                                <option value="failed">Failed</option>
                                <option value="processing">Processing</option>
                            </select>
                            
                            <select class="form-select form-select-sm" id="intentFilter" style="width: auto;">
                                <option value="">All Intents</option>
                                <option value="ROOFING">Roofing</option>
                                <option value="WINDOWS_DOORS">Windows/Doors</option>
                                <option value="PLUMBING">Plumbing</option>
                                <option value="ELECTRICAL">Electrical</option>
                                <option value="HVAC">HVAC</option>
                                <option value="FLOORING">Flooring</option>
                                <option value="SIDING_EXTERIOR">Siding/Exterior</option>
                                <option value="KITCHEN_BATH">Kitchen/Bath</option>
                                <option value="GENERAL_CONTRACTOR">General Contractor</option>
                                <option value="EMERGENCY_REPAIR">Emergency Repair</option>
                                <option value="QUOTE_REQUEST">Quote Request</option>
                                <option value="COMPLAINT">Complaint</option>
                                <option value="OTHER">Other</option>
                            </select>
                            
                            <select class="form-select form-select-sm" id="subIntentFilter" style="width: auto;">
                                <option value="">All Sub-Intents</option>
                                <!-- Roofing Sub-Intents -->
                                <option value="ROOF_REPAIR">Roof Repair</option>
                                <option value="ROOF_REPLACEMENT">Roof Replacement</option>
                                <option value="ROOF_PURCHASE">Roof Purchase</option>
                                <option value="ROOF_INSPECTION">Roof Inspection</option>
                                <!-- Windows/Doors Sub-Intents -->
                                <option value="WINDOW_REPAIR">Window Repair</option>
                                <option value="WINDOW_REPLACEMENT">Window Replacement</option>
                                <option value="DOOR_INSTALLATION">Door Installation</option>
                                <!-- HVAC Sub-Intents -->
                                <option value="AC_REPAIR">AC Repair</option>
                                <option value="HEATING_REPAIR">Heating Repair</option>
                                <!-- Kitchen/Bath Sub-Intents -->
                                <option value="BATHROOM_REMODEL">Bathroom Remodel</option>
                                <option value="KITCHEN_REMODEL">Kitchen Remodel</option>
                                <!-- Quote Request Sub-Intents -->
                                <option value="ESTIMATE_REQUEST">Estimate Request</option>
                                <option value="CONSULTATION">Consultation</option>
                                <!-- Other Sub-Intents -->
                                <option value="GENERAL_INQUIRY">General Inquiry</option>
                                <option value="TEST_CALL">Test Call</option>
                                <option value="WRONG_NUMBER">Wrong Number</option>
                                <option value="COMPLAINT">Complaint</option>
                                <option value="APPOINTMENT_SCHEDULING">Appointment Scheduling</option>
                            </select>
                            
                            <select class="form-select form-select-sm" id="durationFilter" style="width: auto;">
                                <option value="">All Durations</option>
                                <option value="short">Under 60 seconds</option>
                                <option value="medium">Under 120 seconds</option>
                                <option value="long">120+ seconds</option>
                            </select>
                            
                            <select class="form-select form-select-sm" id="primaryDispositionFilter" style="width: auto;">
                                <option value="">All Primary Dispositions</option>
                                <option value="APPOINTMENT_SET">Appointment Set</option>
                                <option value="QUALIFIED_LEAD">Qualified Lead</option>
                                <option value="NOT_QUALIFIED">Not Qualified</option>
                                <option value="NOT_INTERESTED">Not Interested</option>
                                <option value="CALLBACK_REQUESTED">Callback Requested</option>
                                <option value="WRONG_NUMBER">Wrong Number</option>
                                <option value="NO_ANSWER">No Answer</option>
                                <option value="HANG_UP">Hang Up</option>
                                <option value="VOICEMAIL">Voicemail</option>
                                <option value="TECHNICAL_ISSUE">Technical Issue</option>
                                <option value="OTHER">Other</option>
                            </select>
                            
                            <select class="form-select form-select-sm" id="secondaryDispositionFilter" style="width: auto;">
                                <option value="">All Secondary Dispositions</option>
                                <option value="IMMEDIATE">Immediate</option>
                                <option value="FUTURE">Future</option>
                                <option value="PRICE_OBJECTION">Price Objection</option>
                                <option value="TRUST_OBJECTION">Trust Objection</option>
                                <option value="DECISION_MAKER">Not Decision Maker</option>
                                <option value="RESEARCH_NEEDED">Research Needed</option>
                                <option value="COMPETITOR">Has Competitor</option>
                                <option value="SEASONAL">Seasonal Timing</option>
                                <option value="BUDGET_CONSTRAINTS">Budget Constraints</option>
                                <option value="PROPERTY_ISSUE">Property Issue</option>
                                <option value="REFERRAL_NEEDED">Referral Needed</option>
                                <option value="FOLLOW_UP_REQUIRED">Follow Up Required</option>
                                <option value="OTHER">Other</option>
                            </select>
                            
                            <div class="btn-group">
                                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                    <i class="bi bi-download me-1"></i>Export
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#" id="exportCsv">Export as CSV</a></li>
                                    <li><a class="dropdown-item" href="#" id="exportJson">Export as JSON</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="analytics-card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0" id="transcriptionTable">
                            <thead class="table-light">
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Filename</th>
                                    <th>Size</th>
                                    <th>Duration</th>
                                    <th>Intent</th>
                                    <th>Sub-Intent</th>
                                    <th>Primary Disposition</th>
                                    <th>Secondary Disposition</th>
                                    <th>Summary</th>
                                    <th>Status</th>
                                    <th>Processing</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block modals %}
<!-- Upload Modal -->
<div class="modal fade" id="uploadModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-cloud-upload-fill me-2"></i>
                    Upload Audio Files
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="uploadForm">
                    <div class="mb-3">
                        <label for="audioFile" class="form-label">Select Audio Files</label>
                        <input type="file" class="form-control" id="audioFile" accept=".mp3,.wav,.m4a,.flac,.ogg" multiple>
                        <div class="form-text">
                            Supported formats: MP3, WAV, M4A, FLAC, OGG (Max: 100MB each). You can select multiple files.
                        </div>
                    </div>
                    <div id="fileList" class="mb-3 d-none">
                        <h6>Selected Files:</h6>
                        <div id="selectedFiles" class="border rounded p-2 bg-light"></div>
                    </div>
                    <div class="progress d-none" id="uploadProgress">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="uploadBtn">
                    <i class="bi bi-cloud-upload-fill me-1"></i>Upload
                </button>
            </div>
        </div>
    </div>
</div>

<!-- S3 Browse Modal -->
<div class="modal fade" id="s3Modal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-cloud-fill me-2"></i>
                    AWS S3 Recordings
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <div class="input-group">
                            <span class="input-group-text">Show files from last</span>
                            <select class="form-select" id="s3TimeFilter" style="max-width: 150px;">
                                <option value="24">24 hours</option>
                                <option value="72">3 days</option>
                                <option value="168" selected>1 week</option>
                                <option value="720">1 month</option>
                            </select>
                            <button class="btn btn-outline-primary" id="refreshS3">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <div id="s3Stats" class="small text-muted">Loading...</div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="s3RecordingsTable">
                        <thead>
                            <tr>
                                <th>Filename</th>
                                <th>Size</th>
                                <th>Last Modified</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
                
                <div id="s3Loading" class="text-center py-4 d-none">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-2">Loading S3 recordings...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" id="downloadAllBtn">
                    <i class="bi bi-download me-1"></i>Download All New
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Details Modal -->
<div class="modal fade" id="detailsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="detailsTitle">Call Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>File Information</h6>
                        <table class="table table-sm">
                            <tr><td><strong>Filename:</strong></td><td id="detailFilename">-</td></tr>
                            <tr><td><strong>Size:</strong></td><td id="detailSize">-</td></tr>
                            <tr><td><strong>Duration:</strong></td><td id="detailDuration">-</td></tr>
                            <tr><td><strong>Status:</strong></td><td id="detailStatus">-</td></tr>
                            <tr><td><strong>Processing Time:</strong></td><td id="detailProcessingTime">-</td></tr>
                            <tr><td><strong>Timestamp:</strong></td><td id="detailTimestamp">-</td></tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <div id="detailError" class="alert alert-danger d-none">
                            <h6>Error Message</h6>
                            <p class="mb-0" id="detailErrorMessage"></p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6>Transcription</h6>
                        <div class="btn-group btn-group-sm" role="group" aria-label="Transcription view">
                            <input type="radio" class="btn-check" name="transcriptionView" id="regularTranscript" checked>
                            <label class="btn btn-outline-primary" for="regularTranscript">Regular</label>
                            
                            <input type="radio" class="btn-check" name="transcriptionView" id="diarizedTranscript">
                            <label class="btn btn-outline-primary" for="diarizedTranscript">Speaker View</label>
                        </div>
                    </div>
                    
                    <!-- Regular Transcription -->
                    <div id="regularTranscriptionView" class="border rounded p-3 bg-light transcription-text" style="max-height: 200px; overflow-y: auto;">
                        <p id="detailTranscription" class="mb-0">-</p>
                    </div>
                    
                    <!-- Diarized Transcription -->
                    <div id="diarizedTranscriptionView" class="border rounded p-3 bg-light transcription-text" style="max-height: 200px; overflow-y: auto; display: none;">
                        <div id="detailDiarizedTranscription" class="mb-0">-</div>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6>Call Summary</h6>
                    <div class="border rounded p-3 bg-light">
                        <p id="detailSummary" class="mb-0">-</p>
                    </div>
                </div>
                
                <div class="mt-4">
                    <h6>Intent Classification</h6>
                    <div class="border rounded p-3 bg-light">
                        <div class="mb-2">
                            <strong>Primary Intent:</strong>
                            <span id="detailIntent" class="badge bg-primary fs-6 ms-2">-</span>
                        </div>
                        <div>
                            <strong>Sub-Intent:</strong>
                            <span id="detailSubIntent" class="badge bg-info fs-6 ms-2">-</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-warning" id="reprocessBtn">
                    <i class="bi bi-arrow-repeat me-1"></i>Reprocess
                </button>
                <button type="button" class="btn btn-danger" id="deleteBtn">
                    <i class="bi bi-trash me-1"></i>Delete
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Summary Modal -->
<div class="modal fade" id="summaryModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="summaryModalTitle">Call Summary</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="border rounded p-3 bg-light">
                    <p id="summaryModalContent" class="mb-0">Loading...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Transcript Modal -->
<div class="modal fade" id="transcriptModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content" style="height: 85vh;">
            <div class="modal-header bg-gradient" style="background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); color: white;">
                <div>
                    <h5 class="modal-title mb-0" id="transcriptModalTitle">
                        <i class="bi bi-chat-dots me-2"></i>Call Transcript
                    </h5>
                    <small style="color: rgba(255,255,255,0.8);" id="transcriptModalSubtitle">Professional conversation view</small>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1);"></button>
            </div>
            <div class="modal-body p-0" style="background: #f5f7fa;">
                <div id="transcriptModalContent" class="h-100">
                    <div class="d-flex align-items-center justify-content-center h-100">
                        <div class="text-center">
                            <div class="spinner-border text-primary mb-3" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <div class="text-muted">Loading conversation...</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer bg-light border-top">
                <div class="text-muted small me-auto">
                    <i class="bi bi-info-circle me-1"></i>
                    Conversation analysis powered by AI
                </div>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-lg me-1"></i>Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmTitle">Confirm Action</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p id="confirmMessage">Are you sure?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmBtn">Confirm</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}